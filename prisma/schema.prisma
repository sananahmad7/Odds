generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ContentType {
  heading
  subheading
  text
  image
}

/**
 * NEW League enum
 */
enum League {
  NFL
  NBA
  NCAAF
  NCAAB
  MLB
  UFC
}

model Article {
  id          Int      @id @default(autoincrement())
  slug        String   @unique
  title       String
  description String
  thumbnail   String
  publishedAt DateTime
  isFeatured  Boolean? @default(false)
  published   Boolean  @default(false)

  /**
   * NEW: league replaces categories
   */
  league League

  /**
   * REMOVED: categories Category[] @relation("ArticleCategories")
   */

  contentBlocks ArticleContent[]
  metaTags      String[]         @default([])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([league])
}

model ArticleContent {
  id          Int         @id @default(autoincrement())
  type        ContentType
  content     String
  description String?
  order       Int
  article     Article     @relation(fields: [articleId], references: [id], onDelete: Cascade)
  articleId   Int
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  @@index([articleId, order])
}

enum AdminRole {
  ADMIN
}

model Admin {
  id           Int       @id @default(autoincrement())
  email        String    @unique
  passwordHash String
  name         String?
  role         AdminRole @default(ADMIN)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
}

model ContactMessage {
  id        Int      @id @default(autoincrement())
  name      String
  email     String
  message   String   @db.Text
  createdAt DateTime @default(now())
  read      Boolean  @default(false)

  @@index([createdAt])
}

/////////// ODDS /////////////
model OddsEvent {
  id               String            @id
  sportKey         String
  sportTitle       String
  commenceTime     DateTime
  homeTeam         String
  awayTeam         String
  image            String            @default("")
  bookmakers       OddsBookmaker[]
  eventpredictions Eventprediction[]
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @default(now()) @updatedAt

  @@index([commenceTime])
}

model OddsBookmaker {
  id         String       @id @default(cuid())
  eventId    String
  key        String
  title      String
  lastUpdate DateTime
  markets    OddsMarket[]
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @default(now()) @updatedAt

  event OddsEvent @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@unique([eventId, key]) // yields where: { eventId_key: { ... } }
}

model OddsMarket {
  id          String        @id @default(cuid())
  bookmakerId String
  key         String
  lastUpdate  DateTime
  outcomes    OddsOutcome[]
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @default(now()) @updatedAt

  bookmaker OddsBookmaker @relation(fields: [bookmakerId], references: [id], onDelete: Cascade)

  @@unique([bookmakerId, key]) // yields where: { bookmakerId_key: { ... } }
}

model OddsOutcome {
  id        String   @id @default(cuid())
  marketId  String
  name      String
  price     Int
  point     Float?
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  market OddsMarket @relation(fields: [marketId], references: [id], onDelete: Cascade)

  @@unique([marketId, name]) // yields where: { marketId_name: { ... } }
}

model Eventprediction {
  id                  Int       @id @default(autoincrement())
  articleTitle        String    @default("")
  article1Heading     String    @default("")
  article1Description String    @default("")
  article2Heading     String    @default("")
  article2Description String    @default("")
  article3Heading     String    @default("")
  article3Description String    @default("")
  event               OddsEvent @relation(fields: [oddsEventId], references: [id])
  oddsEventId         String
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @default(now()) @updatedAt

  @@index([oddsEventId]) // Create index on oddsEventId
}
